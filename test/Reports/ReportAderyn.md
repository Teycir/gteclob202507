# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Contract locks Ether without a withdraw function](#h-1-contract-locks-ether-without-a-withdraw-function)
  - [H-2: Reentrancy: State change after external call](#h-2-reentrancy-state-change-after-external-call)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Unspecific Solidity Pragma](#l-2-unspecific-solidity-pragma)
  - [L-3: Address State Variable Set Without Checks](#l-3-address-state-variable-set-without-checks)
  - [L-4: Public Function Not Used Internally](#l-4-public-function-not-used-internally)
  - [L-5: Literal Instead of Constant](#l-5-literal-instead-of-constant)
  - [L-6: Using `block.timestamp` for swap deadline offers no protection](#l-6-using-blocktimestamp-for-swap-deadline-offers-no-protection)
  - [L-7: PUSH0 Opcode](#l-7-push0-opcode)
  - [L-8: Modifier Invoked Only Once](#l-8-modifier-invoked-only-once)
  - [L-9: Large Numeric Literal](#l-9-large-numeric-literal)
  - [L-10: Internal Function Used Only Once](#l-10-internal-function-used-only-once)
  - [L-11: Unused Error](#l-11-unused-error)
  - [L-12: Loop Contains `require`/`revert`](#l-12-loop-contains-requirerevert)
  - [L-13: Costly operations inside loop](#l-13-costly-operations-inside-loop)
  - [L-14: Missing Inheritance](#l-14-missing-inheritance)
  - [L-15: Unused Import](#l-15-unused-import)
  - [L-16: State Change Without Event](#l-16-state-change-without-event)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 32 |
| Total nSLOC | 2765 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| contracts/account-manager/AccountManager.sol | 211 |
| contracts/account-manager/IAccountManager.sol | 25 |
| contracts/clob/CLOB.sol | 634 |
| contracts/clob/CLOBManager.sol | 211 |
| contracts/clob/ICLOB.sol | 107 |
| contracts/clob/ICLOBManager.sol | 33 |
| contracts/clob/ILimitLens.sol | 18 |
| contracts/clob/types/Book.sol | 339 |
| contracts/clob/types/FeeData.sol | 89 |
| contracts/clob/types/Order.sol | 74 |
| contracts/clob/types/RedBlackTree.sol | 45 |
| contracts/clob/types/Roles.sol | 11 |
| contracts/clob/types/TransientMakerData.sol | 102 |
| contracts/launchpad/Distributor.sol | 139 |
| contracts/launchpad/LaunchToken.sol | 13 |
| contracts/launchpad/LaunchpadLPVault.sol | 3 |
| contracts/launchpad/interfaces/IBondingCurveMinimal.sol | 3 |
| contracts/launchpad/interfaces/IDistributor.sol | 20 |
| contracts/launchpad/interfaces/IGTELaunchpadV2Pair.sol | 4 |
| contracts/launchpad/interfaces/ILaunchpad.sol | 57 |
| contracts/launchpad/interfaces/ISimpleLaunchpad.sol | 6 |
| contracts/launchpad/interfaces/IUniV2Factory.sol | 4 |
| contracts/launchpad/interfaces/IUniswapV2FactoryMinimal.sol | 5 |
| contracts/launchpad/interfaces/IUniswapV2Pair.sol | 44 |
| contracts/launchpad/interfaces/IUniswapV2RouterMinimal.sol | 32 |
| contracts/launchpad/libraries/RewardsTracker.sol | 169 |
| contracts/router/GTERouter.sol | 246 |
| contracts/router/interfaces/IUniswapV2Router01.sol | 10 |
| contracts/utils/Operator.sol | 51 |
| contracts/utils/interfaces/IOperator.sol | 6 |
| contracts/utils/types/EventNonce.sol | 22 |
| contracts/utils/types/OperatorHelperLib.sol | 32 |
| **Total** | **2765** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 2 |
| Low | 16 |


# High Issues

## H-1: Contract locks Ether without a withdraw function

It appears that the contract includes a payable function to accept Ether but lacks a corresponding function to withdraw it, which leads to the Ether being locked in the contract. To resolve this issue, please implement a public or external function that allows for the withdrawal of Ether from the contract.

<details><summary>4 Found Instances</summary>


- Found in contracts/account-manager/AccountManager.sol [Line: 27](../../contracts/account-manager/AccountManager.sol#L27)

	```solidity
	contract AccountManager is IAccountManager, Operator, Initializable, OwnableRoles {
	```

- Found in contracts/clob/CLOBManager.sol [Line: 54](../../contracts/clob/CLOBManager.sol#L54)

	```solidity
	contract CLOBManager is ICLOBManager, CLOBAdminOwnableRoles, Initializable {
	```

- Found in contracts/launchpad/Distributor.sol [Line: 13](../../contracts/launchpad/Distributor.sol#L13)

	```solidity
	contract Distributor is OwnableRoles, IDistributor {
	```

- Found in contracts/router/GTERouter.sol [Line: 22](../../contracts/router/GTERouter.sol#L22)

	```solidity
	contract GTERouter is ReentrancyGuardTransient {
	```

</details>



## H-2: Reentrancy: State change after external call

Changing state after an external call can lead to re-entrancy attacks.Use the checks-effects-interactions pattern to avoid this issue.

<details><summary>2 Found Instances</summary>


- Found in contracts/clob/CLOBManager.sol [Line: 174](../../contracts/clob/CLOBManager.sol#L174)

	State is changed at: `self.isCLOB[marketAddress] = true`, `self.clob[tokenPairHash] = marketAddress`
	```solidity
	        uint8 quoteDecimals = IERC20Metadata(quoteToken).decimals();
	```

- Found in contracts/clob/CLOBManager.sol [Line: 175](../../contracts/clob/CLOBManager.sol#L175)

	State is changed at: `self.isCLOB[marketAddress] = true`, `self.clob[tokenPairHash] = marketAddress`
	```solidity
	        uint8 baseDecimals = IERC20Metadata(baseToken).decimals();
	```

</details>



# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>1 Found Instances</summary>


- Found in contracts/launchpad/Distributor.sol [Line: 39](../../contracts/launchpad/Distributor.sol#L39)

	```solidity
	    function initialize(address _launchpad) public onlyOwner {
	```

</details>



## L-2: Unspecific Solidity Pragma

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

<details><summary>3 Found Instances</summary>


- Found in contracts/clob/ICLOB.sol [Line: 2](../../contracts/clob/ICLOB.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

- Found in contracts/clob/ICLOBManager.sol [Line: 2](../../contracts/clob/ICLOBManager.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

- Found in contracts/utils/interfaces/IOperator.sol [Line: 2](../../contracts/utils/interfaces/IOperator.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

</details>



## L-3: Address State Variable Set Without Checks

Check for `address(0)` when assigning values to address state variables.

<details><summary>1 Found Instances</summary>


- Found in contracts/launchpad/Distributor.sol [Line: 41](../../contracts/launchpad/Distributor.sol#L41)

	```solidity
	        launchpad = _launchpad;
	```

</details>



## L-4: Public Function Not Used Internally

If a function is marked public but is not used internally, consider marking it as `external`.

<details><summary>1 Found Instances</summary>


- Found in contracts/launchpad/Distributor.sol [Line: 39](../../contracts/launchpad/Distributor.sol#L39)

	```solidity
	    function initialize(address _launchpad) public onlyOwner {
	```

</details>



## L-5: Literal Instead of Constant

Define and use `constant` variables instead of using literals. If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>2 Found Instances</summary>


- Found in contracts/clob/CLOBManager.sol [Line: 181](../../contracts/clob/CLOBManager.sol#L181)

	```solidity
	        config.quoteSize = 10 ** quoteDecimals;
	```

- Found in contracts/clob/CLOBManager.sol [Line: 182](../../contracts/clob/CLOBManager.sol#L182)

	```solidity
	        config.baseSize = 10 ** baseDecimals;
	```

</details>



## L-6: Using `block.timestamp` for swap deadline offers no protection

In the PoS model, proposers know well in advance if they will propose one or consecutive blocks ahead of time. In such a scenario, a malicious validator can hold back the transaction and execute it at a more favourable block number.Consider allowing function caller to specify swap deadline input parameter.

<details><summary>1 Found Instances</summary>


- Found in contracts/router/GTERouter.sol [Line: 339](../../contracts/router/GTERouter.sol#L339)

	```solidity
	        uint256[] memory amounts = uniV2Router.swapExactTokensForTokens(
	```

</details>



## L-7: PUSH0 Opcode

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

<details><summary>5 Found Instances</summary>


- Found in contracts/clob/ICLOB.sol [Line: 2](../../contracts/clob/ICLOB.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

- Found in contracts/clob/ICLOBManager.sol [Line: 2](../../contracts/clob/ICLOBManager.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

- Found in contracts/clob/types/TransientMakerData.sol [Line: 2](../../contracts/clob/types/TransientMakerData.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

- Found in contracts/router/GTERouter.sol [Line: 2](../../contracts/router/GTERouter.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

- Found in contracts/utils/interfaces/IOperator.sol [Line: 2](../../contracts/utils/interfaces/IOperator.sol#L2)

	```solidity
	pragma solidity ^0.8.27;
	```

</details>



## L-8: Modifier Invoked Only Once

Consider removing the modifier or inlining the logic into the calling function.

<details><summary>1 Found Instances</summary>


- Found in contracts/router/GTERouter.sol [Line: 88](../../contracts/router/GTERouter.sol#L88)

	```solidity
	    modifier inTime(uint256 deadline) {
	```

</details>



## L-9: Large Numeric Literal

Large literal values multiples of 10000 can be replaced with scientific notation.Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>1 Found Instances</summary>


- Found in contracts/clob/types/FeeData.sol [Line: 88](../../contracts/clob/types/FeeData.sol#L88)

	```solidity
	    uint256 constant FEE_SCALING = 10_000_000;
	```

</details>



## L-10: Internal Function Used Only Once

Instead of separating the logic into a separate function, consider inlining the logic into the calling function. This can reduce the number of function calls and improve readability.

<details><summary>3 Found Instances</summary>


- Found in contracts/clob/types/Book.sol [Line: 119](../../contracts/clob/types/Book.sol#L119)

	```solidity
	    function setMaxLimitExemptTransient(address who, bool toggle) internal {
	```

- Found in contracts/clob/types/Book.sol [Line: 165](../../contracts/clob/types/Book.sol#L165)

	```solidity
	    function isMaxLimitExempt(Book storage self, address factory, address who) internal returns (bool allowed) {
	```

- Found in contracts/clob/types/Book.sol [Line: 244](../../contracts/clob/types/Book.sol#L244)

	```solidity
	    function getTransientLimitsPlaced() internal view returns (uint8 limitsPlaced) {
	```

</details>



## L-11: Unused Error

Consider using or removing the unused error.

<details><summary>5 Found Instances</summary>


- Found in contracts/clob/CLOB.sol [Line: 114](../../contracts/clob/CLOB.sol#L114)

	```solidity
	    error FactoryUnauthorized();
	```

- Found in contracts/clob/CLOBManager.sol [Line: 77](../../contracts/clob/CLOBManager.sol#L77)

	```solidity
	    error CLOBBeaconMustHaveRouter();
	```

- Found in contracts/router/GTERouter.sol [Line: 35](../../contracts/router/GTERouter.sol#L35)

	```solidity
	    error UnwrapWethOnly();
	```

- Found in contracts/router/GTERouter.sol [Line: 45](../../contracts/router/GTERouter.sol#L45)

	```solidity
	    error InvalidCLOBAmountSide();
	```

- Found in contracts/utils/Operator.sol [Line: 49](../../contracts/utils/Operator.sol#L49)

	```solidity
	    error OperatorDoesNotHaveRole();
	```

</details>



## L-12: Loop Contains `require`/`revert`

Avoid `require` / `revert` statements in a loop because a single bad item can cause the whole transaction to fail. It's better to forgive on fail and return failed elements post processing of the loop

<details><summary>5 Found Instances</summary>


- Found in contracts/account-manager/AccountManager.sol [Line: 263](../../contracts/account-manager/AccountManager.sol#L263)

	```solidity
	        for (uint256 i; i < params.makerCredits.length; ++i) {
	```

- Found in contracts/clob/CLOB.sol [Line: 908](../../contracts/clob/CLOB.sol#L908)

	```solidity
	        for (uint256 i = 0; i < numOrders; i++) {
	```

- Found in contracts/clob/types/Book.sol [Line: 193](../../contracts/clob/types/Book.sol#L193)

	```solidity
	        while (count < numOrders && !currentOrder.isNull()) {
	```

- Found in contracts/clob/types/Book.sol [Line: 220](../../contracts/clob/types/Book.sol#L220)

	```solidity
	        while (counter < pageSize) {
	```

- Found in contracts/router/GTERouter.sol [Line: 275](../../contracts/router/GTERouter.sol#L275)

	```solidity
	        for (uint256 i = 0; i < hops.length; i++) {
	```

</details>



## L-13: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>6 Found Instances</summary>


- Found in contracts/account-manager/AccountManager.sol [Line: 221](../../contracts/account-manager/AccountManager.sol#L221)

	```solidity
	        for (uint256 i = 0; i < accounts.length; i++) {
	```

- Found in contracts/account-manager/AccountManager.sol [Line: 263](../../contracts/account-manager/AccountManager.sol#L263)

	```solidity
	        for (uint256 i; i < params.makerCredits.length; ++i) {
	```

- Found in contracts/clob/CLOB.sol [Line: 745](../../contracts/clob/CLOB.sol#L745)

	```solidity
	        while (bestAskPrice <= incomingOrder.price && incomingOrder.amount > 0) {
	```

- Found in contracts/clob/CLOB.sol [Line: 779](../../contracts/clob/CLOB.sol#L779)

	```solidity
	        while (bestBidPrice >= incomingOrder.price && incomingOrder.amount > 0) {
	```

- Found in contracts/clob/CLOB.sol [Line: 908](../../contracts/clob/CLOB.sol#L908)

	```solidity
	        for (uint256 i = 0; i < numOrders; i++) {
	```

- Found in contracts/clob/CLOBManager.sol [Line: 279](../../contracts/clob/CLOBManager.sol#L279)

	```solidity
	        for (uint256 i = 0; i < accounts.length; i++) {
	```

</details>



## L-14: Missing Inheritance

There is an interface / abstract contract that is potentially missing (not included in) the inheritance of this contract.

<details><summary>1 Found Instances</summary>


- Found in contracts/utils/Operator.sol [Line: 38](../../contracts/utils/Operator.sol#L38)

	Is this contract supposed to implement an interface? Consider extending one of the following: IOperator
	```solidity
	contract Operator {
	```

</details>



## L-15: Unused Import

Redundant import statement. Consider removing it.

<details><summary>9 Found Instances</summary>


- Found in contracts/account-manager/IAccountManager.sol [Line: 5](../../contracts/account-manager/IAccountManager.sol#L5)

	```solidity
	import {OperatorRoles} from "../utils/Operator.sol";
	```

- Found in contracts/clob/CLOBManager.sol [Line: 6](../../contracts/clob/CLOBManager.sol#L6)

	```solidity
	import {Side} from "./types/Order.sol";
	```

- Found in contracts/clob/CLOBManager.sol [Line: 8](../../contracts/clob/CLOBManager.sol#L8)

	```solidity
	import {MakerCredit} from "./types/TransientMakerData.sol";
	```

- Found in contracts/clob/ICLOBManager.sol [Line: 7](../../contracts/clob/ICLOBManager.sol#L7)

	```solidity
	import {Side} from "./types/Order.sol";
	```

- Found in contracts/clob/ICLOBManager.sol [Line: 8](../../contracts/clob/ICLOBManager.sol#L8)

	```solidity
	import {MakerCredit} from "./types/TransientMakerData.sol";
	```

- Found in contracts/clob/ILimitLens.sol [Line: 4](../../contracts/clob/ILimitLens.sol#L4)

	```solidity
	import {ICLOB} from "./ICLOB.sol";
	```

- Found in contracts/clob/types/TransientMakerData.sol [Line: 4](../../contracts/clob/types/TransientMakerData.sol#L4)

	```solidity
	import {ICLOB} from "../ICLOB.sol";
	```

- Found in contracts/launchpad/Distributor.sol [Line: 6](../../contracts/launchpad/Distributor.sol#L6)

	```solidity
	import {SafeCastLib} from "@solady/utils/SafeCastLib.sol";
	```

- Found in contracts/launchpad/interfaces/ILaunchpad.sol [Line: 10](../../contracts/launchpad/interfaces/ILaunchpad.sol#L10)

	```solidity
	import {IUniswapV2FactoryMinimal} from "./IUniswapV2FactoryMinimal.sol";
	```

</details>



## L-16: State Change Without Event

There are state variable changes in this function but no event is emitted. Consider emitting an event to enable offchain indexers to track the changes.

<details><summary>3 Found Instances</summary>


- Found in contracts/account-manager/AccountManager.sol [Line: 302](../../contracts/account-manager/AccountManager.sol#L302)

	```solidity
	    function creditAccountNoEvent(address account, address token, uint256 amount) external virtual onlyMarket {
	```

- Found in contracts/clob/CLOBManager.sol [Line: 271](../../contracts/clob/CLOBManager.sol#L271)

	```solidity
	    function setMaxLimitsExempt(address[] calldata accounts, bool[] calldata toggles)
	```

- Found in contracts/launchpad/Distributor.sol [Line: 39](../../contracts/launchpad/Distributor.sol#L39)

	```solidity
	    function initialize(address _launchpad) public onlyOwner {
	```

</details>



